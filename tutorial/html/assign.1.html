<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Assign</title>
	<link rel="stylesheet" href="../css/style.css" />
	<script src="../../js/lib/jquery-1.3.2.js"></script>
</head>
<body>	
<div class="container">
<div class="row">
  <div class="col-md-5">
	<select id="nation">
		<option value="US">미국</option>
		<option value="CN">중국</option>
		<option value="DE">독일</option>
		<option value="VE">베트남</option>
	</select>  
	<ul id="target-city"  class="list-group"></ul>
  </div>
  <div class="col-md-2"> 
	<ul class="list-group" style="margin-top:20px;">
	  <a class="list-group-item">+</a>
	  <a class="list-group-item">-</a>
	</ul>  	
  </div>
  <div class="col-md-5">
  	<ul id="selected-city"></ul>
	</div>
	<button id="btn-save">저장</button>
	<input type="hidden" name="assingedNations" value="">

</div>
</div>

<hr/>

<script>
	var target = {
			"US": [{cd: "US08", name: "LA"}, {cd: "US09", name: "뉴욕"}],
			"CN": [{cd: "CN01", name: "베이징"}, {cd: "CN02", name: "상하이-수정"}, {cd: "CN03", name: "칭다오"}],
			"DE": [{cd: "DE10", name: "프랑크푸르트"}, {cd: "DE11", name: "베를린"}],
			"VE": [{cd: "VN07", name: "호치민"}, {cd: "VN08", name: "사이공"}]
		};	
	
	function onChangeNation(e) {
		var nationCd = $(this).val();
		var cityList = target[nationCd];
		
		console.log(cityList);
		
		var html = "";
		
		for(var i = 0; i < cityList.length; i++) {
			html = html + '<li class="list-group-item" data-cd="' + cityList[i].cd + '">' + cityList[i].name + '</li>'; 
		}
		
		console.log(html);
		
		$("#target-city").empty().html(html);
	}
	
	function onClickCity(e) {
		var target = window.event.srcElement;

		if(target.nodeName.toLowerCase() !== "li") {
			return;
		}

		var $el = $(e.target);
		var cityCd = $el.attr("data-cd");
		var $li = $el.clone();
		var oldCityCd;
		 
		var $oldCitys = $("#selected-city").find("li");
		 
		for(var i=0; i<$oldCitys.length; i++) {
			oldCityCd = $( $oldCitys[i] ).attr("data-cd");
			if(oldCityCd === cityCd) {
				return;
			}
		}
		
		$("#selected-city").append($li);
	}
	
	function removeCity(e) {
		var target = window.event.srcElement;

		if(target.nodeName.toLowerCase() !== "li") {
			return;
		}		

		$(e.target).remove();
	}

	function save() {
		var nations = $("#selected-city").find("li");
		var nationCodes = [];

		for(var i = 0; i < nations.length; i++) {
			nationCodes.push(  $(nations[i]).attr("data-cd")  );
		}

		/* option 인경우 
		var nations = $("#selected-city").find("option");
		var nationCodes = [];

		for(var i = 0; i < nations.length; i++) {
			nationCodes.push( nations[i].value   );
		}

		*/


		console.log(nationCodes.join());

		$("input[name='assingedNations']").val( nationCodes.join() );
	}
	
	$("#nation").live("change", onChangeNation).trigger("change");
	
	$("#target-city").live("dblclick", onClickCity);
	
	$("#selected-city").live("dblclick",  removeCity);

	$("#btn-save").click(save);
	
</script>	 

<xmp theme="united" style="display:none;">
	// IE event 문제 Start
	if(e.target.nodeName.toLowerCase() !== "option") {
		return;
	}  	
====>

	var target = window.event.srcElement;
	if(target.nodeName.toLowerCase() !== "option") {
			return;
	}  	
	// IE event 문제 end

	// java for 구문 예제 Start

	String nationCodes = "CN, NN, MD";
	String[] nationList = nationCodes.split(",");
	int i;

	for(i = 0; nationList.length; i++) {
		query(nationList[i]);
	}

	// java for 구문 예제 End

	<!DOCTYPE html>
	<html>
	
	<head>
		<meta charset="UTF-8">
		<title>Assign</title>
		<link rel="stylesheet" href="../css/style.css" />
		<script src="../../js/lib/jquery-1.3.2.js"></script>
	</head>
	<body>	
	<div class="container">
	<div class="row">
		<div class="col-md-5">
		<select id="nation">
			<option value="US">미국</option>
			<option value="CN">중국</option>
			<option value="DE">독일</option>
			<option value="VE">베트남</option>
		</select>  
		<ul id="target-city"  class="list-group"></ul>
		</div>
		<div class="col-md-2"> 
		<ul class="list-group" style="margin-top:20px;">
			<a class="list-group-item">+</a>
			<a class="list-group-item">-</a>
			<a class="list-group-item">-</a>
		</ul>  	
		</div>
		<div class="col-md-5">
			<ul id="selected-city"></ul>
		</div>
	</div>
	<button id="btn-save">저장</button>
	<input type="hidden" name="assingedNations" value="">	
	</div>
		
	<script>
		var target = {
				"US": [{cd: "US08", name: "LA"}, {cd: "US09", name: "뉴욕"}],
				"CN": [{cd: "CN01", name: "베이징"}, {cd: "CN02", name: "상하이-수정"}, {cd: "CN03", name: "칭다오"}],
				"DE": [{cd: "DE10", name: "프랑크푸르트"}, {cd: "DE11", name: "베를린"}],
				"VE": [{cd: "VN07", name: "호치민"}, {cd: "VN08", name: "사이공"}]
			};	
		
		function onChangeNation(e) {
			var nationCd = $(this).val();
			var cityList = target[nationCd];
			
			console.log(cityList);
			
			var html = "";
			
			for(var i = 0; i < cityList.length; i++) {
				html = html + '<li class="list-group-item" data-cd="' + cityList[i].cd + '">' + cityList[i].name + '</li>'; 
			}
			
			console.log(html);
			
			$("#target-city").empty().html(html);
		}
		
		function onClickCity(e) {
			// target 체크 : event가 발생한 대상이 li 인지 확인
			
			var target = window.event.srcElement;
			if(target.nodeName.toLowerCase() !== "li") {
				return;
			}
			var $el = $(e.target);
			var cityCd = $el.attr("data-cd");

			var $li = $el.clone();
			var oldCityCd;
			 
			var $oldCitys = $("#selected-city").find("li");
			 
			for(var i=0; i<$oldCitys.length; i++) {
				oldCityCd = $( $oldCitys[i] ).attr("data-cd");
				if(oldCityCd === cityCd) {
					return;
				}
			}
			
			$("#selected-city").append($li);
		}
		
		function removeCity(e) {
			// target 체크 : event가 발생한 대상이 li 인지 확인

			var target = window.event.srcElement;
			if(target.nodeName.toLowerCase() !== "li") {
				return;
			}		
	
			$(e.target).remove();
		}

	function save() {
		var nations = $("#selected-city").find("li");
		var nationCodes = [];

		for(var i = 0; i < nations.length; i++) {
			nationCodes.push(  $(nations[i]).attr("data-cd")  );
		}

		/* option 인경우 
		var nations = $("#selected-city").find("option");
		var nationCodes = [];

		for(var i = 0; i < nations.length; i++) {
			nationCodes.push( nations[i].value   );
		}

		*/


		console.log(nationCodes.join());

		$("input[name='assingedNations']").val( nationCodes.join() );
	}		
		
		// on -> live 
		// $("#nation").on("change", onChangeNation).trigger("change");
		$("#nation").live("change", onChangeNation).trigger("change");
		
		// $("#target-city").on("dblclick", "li", onClickCity);
		$("#target-city").live("dblclick", onClickCity);
		
		// $("#selected-city").on("dblclick", "li", removeCity);
		$("#selected-city").live("dblclick",  removeCity);

		$("#btn-save").click(save);
		
	</script>	 
	</body>
	</html>
</xmp>

<div id="index-container">
	<ul></ul>
	<button id="btn-index">목차</button>
</div>

<script src="../../js/lib/jquery.postjson.js"></script>
<script src="../md/strapdown.js"></script>
<script src="../js/common.js"></script>
</body>	
</html>